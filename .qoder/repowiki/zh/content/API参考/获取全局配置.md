# 获取全局配置

<cite>
**本文档引用的文件**
- [serverV2.py](file://serverV2.py#L247-L251)
- [config.json](file://config.json)
- [index.html](file://index.html#L4085-L4102)
</cite>

## 目录
1. [接口概述](#接口概述)
2. [请求详情](#请求详情)
3. [响应详情](#响应详情)
4. [使用示例](#使用示例)
5. [错误处理](#错误处理)
6. [前端集成说明](#前端集成说明)

## 接口概述

`/api/get_llm_config` 是一个用于获取系统全局配置的GET接口。该接口是整个应用配置管理的入口点，负责读取并返回位于项目根目录下的 `config.json` 配置文件的全部内容。前端应用通过调用此接口获取当前的系统配置，用于初始化和填充“全局设置”模态框中的各项配置项。

此接口返回一个包含 `general`、`models`、`tts_models`、`elevenlabs` 等顶级键的完整JSON对象，涵盖了应用运行所需的所有核心配置，包括默认模型、API密钥、代理设置和TTS服务端点等。任何对系统配置的修改都必须先通过此接口获取当前状态，然后进行更新。

**Section sources**
- [serverV2.py](file://serverV2.py#L247-L251)
- [config.json](file://config.json)

## 请求详情

| 属性 | 说明 |
| :--- | :--- |
| **HTTP方法** | GET |
| **端点路径** | `/api/get_llm_config` |
| **请求参数** | 无 |
| **请求头** | 无特殊要求 |

## 响应详情

| 属性 | 说明 |
| :--- | :--- |
| **响应类型** | JSON |
| **内容类型** | `application/json` |
| **响应体** | `config.json` 文件的完整JSON内容 |

返回的JSON对象包含以下主要部分：

- **`general`**: 通用设置，如默认使用的LLM模型和TTS模型，以及代理服务器配置。
- **`models`**: 定义了可用的大型语言模型（LLM）及其配置，包括显示名称、API密钥、最大字符数和是否使用代理。
- **`tts_models`**: 定义了可用的文本转语音（TTS）服务及其配置，包括显示名称和后端服务端点。
- **`elevenlabs`**: 存储ElevenLabs服务的API密钥。
- **`audio_export`**: 音频导出的格式和质量设置。

**Section sources**
- [config.json](file://config.json)

## 使用示例

### 使用 curl 命令

```bash
curl -X GET "http://localhost:8000/api/get_llm_config"
```

### 使用 JavaScript fetch

```javascript
fetch('/api/get_llm_config')
  .then(response => {
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    return response.json();
  })
  .then(configData => {
    console.log('成功获取配置:', configData);
    // 在此处处理配置数据，例如填充表单
  })
  .catch(error => {
    console.error('获取配置失败:', error);
  });
```

## 错误处理

| 错误码 | 说明 |
| :--- | :--- |
| **404 Not Found** | 当 `config.json` 配置文件不存在时，服务器会返回此错误码。此时，后端会自动触发创建一个包含默认配置的新 `config.json` 文件，并记录日志。 |

**Section sources**
- [serverV2.py](file://serverV2.py#L249-L250)

## 前端集成说明

该接口在前端应用的初始化过程中被调用。在 `index.html` 文件的 `initialize()` 函数中，应用启动时会立即调用 `/api/get_llm_config` 接口来获取全局配置。获取到的配置数据（`state.globalConfig`）会被用来动态填充“全局设置”模态框中的各个配置项，例如LLM模型选择器、API密钥输入框和代理设置等。

此外，当用户在“全局设置”中修改配置并保存后，前端会调用 `/api/update_llm_config` 接口将新的配置数据写回服务器，从而实现配置的持久化。

**Section sources**
- [index.html](file://index.html#L4085-L4102)