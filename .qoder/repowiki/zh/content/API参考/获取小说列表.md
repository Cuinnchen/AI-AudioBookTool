# 获取小说列表

<cite>
**本文档中引用的文件**   
- [serverV2.py](file://serverV2.py#L1610-L1663)
- [index.html](file://index.html#L1236-L1251)
</cite>

## 目录
1. [接口概述](#接口概述)
2. [请求信息](#请求信息)
3. [响应信息](#响应信息)
4. [使用示例](#使用示例)
5. [错误处理](#错误处理)

## 接口概述

`/api/list_novels` 是一个 GET 请求端点，用于获取 `projects/` 目录下所有已上传小说项目的名称列表。该接口的主要功能是为前端提供数据，以填充小说选择的下拉框，使用户能够选择一个已存在的小说项目进行后续操作。

**Section sources**
- [serverV2.py](file://serverV2.py#L1610-L1663)

## 请求信息

- **方法**: `GET`
- **路径**: `/api/list_novels`
- **参数**: 无
- **描述**: 该接口调用简单，无需任何参数。它会扫描服务器上定义的 `PROJECTS_DIR`（即 `projects` 目录），检查每个子目录是否包含 `source.txt` 文件，以此来判断该目录是否为一个有效的小说项目。

## 响应信息

- **格式**: JSON
- **成功状态码**: `200 OK`
- **响应体**: 一个包含 `novels_details` 字段的 JSON 对象。该字段的值是一个字典，其键为小说项目名称，值为该项目的详细信息（包含章节列表和状态）。前端通常只关心键（即小说名称），因此可以通过 `Object.keys(data.novels_details)` 来提取所有小说名称的数组。

**示例响应**:
```json
{
  "novels_details": {
    "小说A": { ... },
    "小说B": { ... }
  }
}
```
根据此响应，前端获取的小说名称列表为 `["小说A", "小说B"]`。

**Section sources**
- [serverV2.py](file://serverV2.py#L1610-L1663)

## 使用示例

### 使用 curl 命令
```bash
curl http://localhost:8000/api/list_novels
```

### 使用 JavaScript fetch
```javascript
async function loadNovels() {
    try {
        const response = await fetch('/api/list_novels');
        const data = await response.json();
        const novelNames = Object.keys(data.novels_details);
        // 将 novelNames 数组用于填充下拉框
        console.log(novelNames); // 输出: ["小说A", "小说B"]
    } catch (error) {
        console.error('加载小说列表失败:', error);
    }
}
```

**Section sources**
- [index.html](file://index.html#L1236-L1251)

## 错误处理

- **主要错误状态码**: `500 Internal Server Error`
- **错误原因**: 此错误通常发生在服务器尝试读取 `projects/` 目录时失败。可能的原因包括：
  1. `projects/` 目录不存在。
  2. 服务器进程没有读取 `projects/` 目录的权限。
- **建议**: 如果调用失败并返回 500 错误，请检查服务器文件系统，确保 `projects/` 目录存在且可读。

**Section sources**
- [serverV2.py](file://serverV2.py#L1610-L1663)